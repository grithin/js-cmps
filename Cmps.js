(function(){window.Cmps={all:{},dependencies:{},loaded:{},cache:{},log:console.log.bind(console)},Cmps.singleton=function(e,t){if(!_.isString(e))throw new Error("Component name must be a string");return this.loaded[e]||(this.loaded[e]=new this.all[e](e,t),this.loaded[e].state.trigger("loaded",new Date)),this.loaded[e]},Cmps.add_loaded=function(e){return this.loaded[e.name]?this.loaded[e.name].push(e):this.loaded[e.name]=[e]},Cmps.require=function(e,t,n){if(!this.all[e])throw new Error('Unknown component dependency: "'+e+'"');return this.dependencies[e]?(Cmps.log("Cmps: dependency preloaded: "+e),this.dependencies[e].dependents.push(t),this.dependencies[e].update("require",n)):(Cmps.log("Cmps: dependency loading: "+e),this.dependencies[e]=new this.all[e](e,n),this.dependencies[e].dependents=[t],this.dependencies[e].state.trigger("loaded",new Date)),this.dependencies[e]},Cmps.remove_loaded=function(e){var t,n,s,r;_.isArray(this.loaded[e.name])?this.loaded[e.name]=this.loaded[e.name].filter(function(t){return t!==e}):delete this.loaded[e.name],s=this.dependencies,r=[];for(t in s)n=s[t],n.dependents?r.push(n.dependents=n.dependents.filter(function(t){return t!==e})):r.push(void 0);return r},Cmps.gc=function(){var e,t,n,s;n=this.dependencies,s=[];for(e in n)t=n[e],t.dependents&&!t.dependents.length?(delete this.dependencies[e],s.push(t.destroy())):s.push(void 0);return s},Cmps.dgc=_.debounce(Cmps.gc.bind(Cmps),100),Cmps.page=scoped({current:!1},function(e,t){return this.current&&this.current.destroy(),this.current=Cmps.singleton.apply(Cmps,arguments)}),window.Cmp=function(e){if(!_.isString(e))throw new Error("Component name must be a string");if(this.name=e,this.state||(this.state=new(Backbone.Model.extend())),this.data||this.createData(),this.$els||(this.$els=[]),!this.events)return this.events=[]},Cmp.prototype.require=function(e,t){return Cmps.require(e,this,t)},Cmp.prototype.construct=function(){return this.events.length&&this.attachEvents(),Cmps.add_loaded(this)},Cmp.prototype.attachEvents=function(e){var t,n,s,r;for(e=e||this.events,r=[],n=0,s=e.length;n<s;n++)t=e[n],"capture"===t.type?r.push($(t.target).get(0).addEventListener(t.name,t.fn,!0)):t.selecter?r.push($(t.target).on(t.name,t.selecter,t.fn)):r.push($(t.target).on(t.name,t.fn));return r},Cmp.prototype.detachEvents=function(e){var t,n,s,r;for(e=e||this.events,r=[],n=0,s=e.length;n<s;n++)t=e[n],"capture"===t.type?r.push($(t.target).get(0).removeEventListener(t.name,t.fn,!0)):t.selecter?r.push($(t.target).off(t.name,t.selecter,t.fn)):r.push($(t.target).off(t.name,t.fn));return r},Cmp.prototype.createData=function(e){return null==e&&(e={}),_.isArray(e)?this.data=new(Backbone.Collection.extend())(e):this.data=new(Backbone.Model.extend())(e),this.data.on("remove change add",_.partial(this.update.bind(this),"data"))},Cmp.prototype.destroy=function(){var e,t,n,s;for(Cmps.log("Cmp: destroying: "+this.name),this.$el&&this.$el.remove(),s=this.$els,t=0,n=s.length;t<n;t++)e=s[t],e.remove();return this.events&&this.detachEvents(),Cmps.remove_loaded(this),Cmps.dgc(),this.state.trigger("destroyed",new Date)},Cmp.prototype.createClass=function(e,t){var n;return n=function(){var n;return Cmps.log("Cmp: constructing: "+e),n=t.call(this,arguments[1]),this.construct(),n},Cmps.all[e]=inherited(Cmp,n),Cmps.all[e].prototype.name=e,Cmps.all[e]},Cmp.prototype.update=function(e){return c("Cmp: updating: "+this.name)},Cmp.prototype.el_wrap=function(e){var t,n;return t=$('<div class="cmp_content">'),n=this.name.replace(/[^a-z0-9_]/gi,"_"),t.addClass(n),t.append(e)},Cmp.prototype.el_attached_wrap=function(e){return this.$el=this.el_wrap(e),$("#pc").append(this.$el),this.$el}}).call(this);
//# sourceMappingURL=Cmps.js.map
